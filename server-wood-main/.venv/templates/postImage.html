{% extends "base.html" %}
{% block content %}
<div>
    <div style="text-align: center; padding-top: 40px; display: flex; justify-content: center;">
        <input type="file" id="fileInput">
    </div>
    <img src="#" id="previewImage" style="display: none; max-width: 300px; margin-top: 10px;">
    <div id="result" style="margin-top: 10px;"></div>
    <div id="resultImage"></div>
    
    <button class="btn btn-primary rounded-circle" type="button" onclick="uploadImage()">Xác nhận</button>    
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function uploadImage() {
        // Clear previous result
        document.querySelectorAll('.ClassName').forEach(el => el.remove());

        const fileInput = document.getElementById('fileInput');
        const formData = new FormData();
        formData.append('image', fileInput.files[0]);

        $.ajax({
            url: '/check-wood',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                const container = document.getElementById('result');

                if (response.message === "Not wood") {
                    let div = document.createElement('div');
                    div.textContent = "Hệ thống xác định không phải gỗ! Vui lòng thửใหม่.";
                    div.classList.add('ClassName');
                    container.appendChild(div);
                } else {
                    let divList = document.createElement('div');
                    let count = 0;
                    for (let i = 0; i < response.scores.length; i++) {
                        let div = document.createElement('div');
                        div.textContent = response.labels[i] + ' : ' + response.scores[i] + '%';
                        count += response.scores[i];
                        div.classList.add('ClassName');
                        divList.appendChild(div);
                    }

                    if (count < 100) {
                        let div = document.createElement('div');
                        div.textContent = 'Các loại gỗ khác dự nằm trong ' + (100 - count).toFixed(2) + '%';
                        div.classList.add('ClassName');
                        divList.appendChild(div);
                    }

                    container.appendChild(divList);
                }
            },
            error: function(jqXHR, textStatus, errorMessage) {
                console.error('Failed to upload file:', errorMessage);
            }
        });
    }

    fileInput.onchange = function() {
        const file = this.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewImage = document.getElementById('previewImage');
            previewImage.src = e.target.result;
            previewImage.style.display = 'block';
        };
        reader.readAsDataURL(file);
    };
</script>
{% endblock %}
